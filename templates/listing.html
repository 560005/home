{% extends "base.html" %}

{% block content %}
<div class="listing-page">
    <nav class="breadcrumb">
        <a href="/">Home</a> &gt; 
        <a href="/c/{{ page.extra.category_slug }}/">{{ page.extra.category_slug }}</a> &gt; 
        <span>{{ page.extra.listing_name }}</span>
    </nav>
    
    {% if page.extra.verified %}
    <div class="verified-badge">âœ“ Verified listing</div>
    {% endif %}
    
    {{ page.content | safe }}
    
    {% if page.extra.latitude and page.extra.longitude %}
    <div class="map-container">
        <div id="map" data-lat="{{ page.extra.latitude }}" data-lng="{{ page.extra.longitude }}"></div>
    </div>
    {% endif %}
</div>

{% if page.extra.latitude and page.extra.longitude %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var el = document.getElementById('map');
    if (!el) return;
    var lat = parseFloat(el.dataset.lat);
    var lng = parseFloat(el.dataset.lng);
    var map = L.map('map').setView([lat, lng], 16);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    L.marker([lat, lng]).addTo(map);
});
</script>
{% endif %}
{% endblock %}
